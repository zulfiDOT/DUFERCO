<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>56.0</apiVersion>
    <assignments>
        <name>Add_Conga_Query</name>
        <label>Add_Conga_Query</label>
        <locationX>1546</locationX>
        <locationY>5423</locationY>
        <assignmentItems>
            <assignToReference>CongaQuery</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>CongaQueryTemp</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Conga_Query</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_Template_Key</name>
        <label>Add_Template_Key</label>
        <locationX>1370</locationX>
        <locationY>4727</locationY>
        <assignmentItems>
            <assignToReference>CongaTemplateKey</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Conga_Template.APXTConga4__Conga_Template__r.APXTConga4__Key__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Conga_Query</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>AssignNextStep</name>
        <label>AssignNextStep</label>
        <locationX>886</locationX>
        <locationY>1895</locationY>
        <assignmentItems>
            <assignToReference>NextStep</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>LoopTemplateSelected.Priority__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>LoopTemplateSelected</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Inserisco l&apos;id del prodotto per non farlo duplicare</description>
        <name>AssignProductToList</name>
        <label>AssignProductToList</label>
        <locationX>798</locationX>
        <locationY>1055</locationY>
        <assignmentItems>
            <assignToReference>OrderLineProduct</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Order_Product.Product2Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>FilterProductTemplate</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>AssignTemplateOK</name>
        <label>AssignTemplateOK</label>
        <locationX>1018</locationX>
        <locationY>1655</locationY>
        <assignmentItems>
            <assignToReference>AllTemplateMappings</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>LoopTemplateSelected</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>MinimumPriority</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Assegno il record type dell&apos;account ad un variabile testo</description>
        <name>AssignTypeAccount</name>
        <label>AssignTypeAccount</label>
        <locationX>182</locationX>
        <locationY>455</locationY>
        <assignmentItems>
            <assignToReference>TypeAccountName</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>GetRecordTypeAccount.RecordType.Name</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>GetOrderLine</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>ListCongaTemplateIds</name>
        <label>ListCongaTemplateIds</label>
        <locationX>270</locationX>
        <locationY>2879</locationY>
        <assignmentItems>
            <assignToReference>ListTemplateIds</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Template_Mapping_Id.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Template_Mapping_Id</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Reset_SkipTemplate</name>
        <label>Reset_SkipTemplate</label>
        <locationX>534</locationX>
        <locationY>3455</locationY>
        <assignmentItems>
            <assignToReference>SkipTemplate</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>FilterSkipTempate</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_Conga_Query_Plain_Text</name>
        <label>Set_Conga_Query_Plain_Text</label>
        <locationX>138</locationX>
        <locationY>6479</locationY>
        <assignmentItems>
            <assignToReference>CongaQueryPlainText</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Query_List</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CongaQueryPlainText</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>,</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Query_List</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_Conga_Query_temp</name>
        <label>Set_Conga_Query_temp</label>
        <locationX>1458</locationX>
        <locationY>5183</locationY>
        <assignmentItems>
            <assignToReference>CongaQueryTemp</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>[</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CongaQueryTemp</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Conga_Query.APXTConga4__Alias__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CongaQueryTemp</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>]</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CongaQueryTemp</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Conga_Query.APXTConga4__Conga_Query__r.APXTConga4__Key__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Query_already_exist</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_SkipTemplate_true</name>
        <label>Set_SkipTemplate_true</label>
        <locationX>622</locationX>
        <locationY>3935</locationY>
        <assignmentItems>
            <assignToReference>SkipTemplate</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Esclusioni</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_Template_Key_Plain_Text</name>
        <label>Set_Template_Key_Plain_Text</label>
        <locationX>138</locationX>
        <locationY>6143</locationY>
        <assignmentItems>
            <assignToReference>CongaTemplateKeyPlainText</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Template_Key</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CongaTemplateKeyPlainText</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>,</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Template_Key</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>SetNumber</name>
        <label>SetNumber</label>
        <locationX>182</locationX>
        <locationY>2639</locationY>
        <assignmentItems>
            <assignToReference>NumTemplateToPrint</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>Filter_by_priority</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Template_Mapping_Id</targetReference>
        </connector>
    </assignments>
    <collectionProcessors>
        <description>Teniamo dall&apos;elenco dei template solo quelli che corrispondono allo step di generazione dei documenti</description>
        <name>Filter_by_priority</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>Filter by priority</label>
        <locationX>182</locationX>
        <locationY>2519</locationY>
        <assignNextValueToReference>currentItem_Filter_by_priority_0</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>AllTemplateMappings</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_Filter_by_priority_0.Priority__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <elementReference>NextStep</elementReference>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>SetNumber</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <description>Filtro la lista per il discount type se presente sul conga template</description>
        <name>FilterDiscount</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>FilterDiscount</label>
        <locationX>798</locationX>
        <locationY>1295</locationY>
        <assignNextValueToReference>currentItem_FilterDiscount</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>FilterProductTemplate</collectionReference>
        <conditionLogic>(1 AND 2) OR 3</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_FilterDiscount.DiscountType__c</leftValueReference>
            <operator>IsNull</operator>
            <rightValue>
                <booleanValue>false</booleanValue>
            </rightValue>
        </conditions>
        <conditions>
            <leftValueReference>currentItem_FilterDiscount.DiscountType__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <elementReference>$Record.DiscountType__c</elementReference>
            </rightValue>
        </conditions>
        <conditions>
            <leftValueReference>currentItem_FilterDiscount.DiscountType__c</leftValueReference>
            <operator>IsNull</operator>
            <rightValue>
                <booleanValue>true</booleanValue>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>FilterTypeAccount</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <description>Seleziono solo i conga template per il il prodotto in contesto</description>
        <name>FilterProductTemplate</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>FilterProductTemplate</label>
        <locationX>798</locationX>
        <locationY>1175</locationY>
        <assignNextValueToReference>currentItem_FilterProductTemplate</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>GetCongaTemplateMapping</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_FilterProductTemplate.Product__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <elementReference>Loop_Order_Product.Product2Id</elementReference>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>FilterDiscount</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <name>FilterSkipTempate</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>FilterSkipTempate</label>
        <locationX>534</locationX>
        <locationY>3575</locationY>
        <assignNextValueToReference>currentItem_FilterSkipTempate_0</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>Get_Esclusioni</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_FilterSkipTempate_0.CongaTemplateMapping__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <elementReference>FilterAllTemplateList.Id</elementReference>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>Loop_Esclusioni</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <description>Filtro la lista di conga mapping per account type</description>
        <name>FilterTypeAccount</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>FilterTypeAccount</label>
        <locationX>798</locationX>
        <locationY>1415</locationY>
        <assignNextValueToReference>currentItem_FilterTypeAccount_0</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>FilterDiscount</collectionReference>
        <conditionLogic>(1 AND 2) OR 3</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_FilterTypeAccount_0.AccountType__c</leftValueReference>
            <operator>IsNull</operator>
            <rightValue>
                <booleanValue>false</booleanValue>
            </rightValue>
        </conditions>
        <conditions>
            <leftValueReference>currentItem_FilterTypeAccount_0.AccountType__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <elementReference>TypeAccountName</elementReference>
            </rightValue>
        </conditions>
        <conditions>
            <leftValueReference>currentItem_FilterTypeAccount_0.AccountType__c</leftValueReference>
            <operator>IsNull</operator>
            <rightValue>
                <booleanValue>true</booleanValue>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>LoopTemplateSelected</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <name>Ordina_Template_Mapping</name>
        <elementSubtype>SortCollectionProcessor</elementSubtype>
        <label>Ordina_Template_Mapping</label>
        <locationX>182</locationX>
        <locationY>2399</locationY>
        <collectionProcessorType>SortCollectionProcessor</collectionProcessorType>
        <collectionReference>AllTemplateMappings</collectionReference>
        <connector>
            <targetReference>Filter_by_priority</targetReference>
        </connector>
        <sortOptions>
            <doesPutEmptyStringAndNullFirst>false</doesPutEmptyStringAndNullFirst>
            <sortField>Order__c</sortField>
            <sortOrder>Asc</sortOrder>
        </sortOptions>
    </collectionProcessors>
    <decisions>
        <name>Already_exist_element</name>
        <label>Already_exist_element</label>
        <locationX>1282</locationX>
        <locationY>4607</locationY>
        <defaultConnector>
            <targetReference>Add_Template_Key</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CongaTemplateKey</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>Loop_Conga_Template.APXTConga4__Conga_Template__r.APXTConga4__Key__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Conga_Query</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_SkipTemplate</name>
        <label>Check_SkipTemplate</label>
        <locationX>534</locationX>
        <locationY>4247</locationY>
        <defaultConnector>
            <targetReference>Get_Conga_Template</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Add Template</defaultConnectorLabel>
        <rules>
            <name>Skip</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>SkipTemplate</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>FilterAllTemplateList</targetReference>
            </connector>
            <label>Skip</label>
        </rules>
    </decisions>
    <decisions>
        <name>Esclusione_match_Product</name>
        <label>Esclusione_match_Product</label>
        <locationX>754</locationX>
        <locationY>3815</locationY>
        <defaultConnector>
            <targetReference>Loop_Esclusioni</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>YesMatch</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>OrderLineProduct</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>Loop_Esclusioni.Product__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_SkipTemplate_true</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <description>Controllo la priorità</description>
        <name>MinimumPriority</name>
        <label>MinimumPriority</label>
        <locationX>1018</locationX>
        <locationY>1775</locationY>
        <defaultConnector>
            <targetReference>LoopTemplateSelected</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>YesPriority</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>LoopTemplateSelected.Priority__c</leftValueReference>
                <operator>LessThan</operator>
                <rightValue>
                    <elementReference>NextStep</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>AssignNextStep</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <description>Controllo se il prodotto è già presente nella lista</description>
        <name>ProductCheck</name>
        <label>ProductCheck</label>
        <locationX>534</locationX>
        <locationY>935</locationY>
        <defaultConnector>
            <targetReference>AssignProductToList</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>YesProduct</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>OrderLineProduct</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>Loop_Order_Product.Product2Id</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_Order_Product</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Query_already_exist</name>
        <label>Query_already_exist</label>
        <locationX>1458</locationX>
        <locationY>5303</locationY>
        <defaultConnector>
            <targetReference>Add_Conga_Query</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>YesQuery</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CongaQuery</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>CongaQueryTemp</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_Conga_Query</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Stop_or_Continue</name>
        <label>Stop_or_Continue</label>
        <locationX>182</locationX>
        <locationY>3095</locationY>
        <defaultConnectorLabel>Stop</defaultConnectorLabel>
        <rules>
            <name>Continue</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>NumTemplateToPrint</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Esclusioni</targetReference>
            </connector>
            <label>Continue</label>
        </rules>
    </decisions>
    <description>Creazione documenti Conga sull&apos;oggetto Order
v17: trigger order
v20: filter by priority</description>
    <environments>Default</environments>
    <formulas>
        <name>OutboundMessageFormula</name>
        <dataType>String</dataType>
        <expression>&quot;&amp;solmgr=1&quot; +
&quot;&amp;id=&quot; + {!$Record__Prior.Id} +
&quot;&amp;templateid=&quot; + LEFT({!CongaTemplateKeyPlainText}, LEN({!CongaTemplateKeyPlainText})-1) +
&quot;&amp;queryid=&quot; + LEFT({!CongaQueryPlainText}, LEN({!CongaQueryPlainText})-1) +
&quot;&amp;defaultpdf=1&quot; +
&quot;&amp;ZipFiles=0&quot; +
&quot;&amp;contentsharetype=V&quot; +
&quot;&amp;contentvisibility=AllUsers&quot; +
&quot;&amp;qmode=SalesforceFile&quot;</expression>
    </formulas>
    <interviewLabel>Order - Identify Documents to Print {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Order - Identify Documents to Print</label>
    <loops>
        <name>FilterAllTemplateList</name>
        <label>FilterAllTemplateList</label>
        <locationX>50</locationX>
        <locationY>3335</locationY>
        <collectionReference>Filter_by_priority</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Reset_SkipTemplate</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Loop_Template_Key</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_Conga_Query</name>
        <label>Loop_Conga_Query</label>
        <locationX>1282</locationX>
        <locationY>5063</locationY>
        <collectionReference>Get_Conga_Query</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Set_Conga_Query_temp</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Loop_Conga_Template</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_Conga_Template</name>
        <label>Loop_Conga_Template</label>
        <locationX>930</locationX>
        <locationY>4487</locationY>
        <collectionReference>Get_Conga_Template</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Already_exist_element</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>FilterAllTemplateList</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_Esclusioni</name>
        <label>Loop_Esclusioni</label>
        <locationX>534</locationX>
        <locationY>3695</locationY>
        <collectionReference>Get_Esclusioni</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Esclusione_match_Product</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Check_SkipTemplate</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_Order_Product</name>
        <label>Loop Order Product</label>
        <locationX>182</locationX>
        <locationY>815</locationY>
        <collectionReference>GetOrderLine</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>ProductCheck</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Ordina_Template_Mapping</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_Query_List</name>
        <label>Loop_Query_List</label>
        <locationX>50</locationX>
        <locationY>6359</locationY>
        <collectionReference>CongaQuery</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Set_Conga_Query_Plain_Text</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Update_Order</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_Template_Key</name>
        <label>Loop_Template_Key</label>
        <locationX>50</locationX>
        <locationY>6023</locationY>
        <collectionReference>CongaTemplateKey</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Set_Template_Key_Plain_Text</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Loop_Query_List</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_Template_Mapping_Id</name>
        <label>Loop_Template_Mapping_Id</label>
        <locationX>182</locationX>
        <locationY>2759</locationY>
        <collectionReference>Filter_by_priority</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>ListCongaTemplateIds</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Stop_or_Continue</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Viene effettuato il loop per tutti i conga template che rispettano in filtro</description>
        <name>LoopTemplateSelected</name>
        <label>LoopTemplateSelected</label>
        <locationX>798</locationX>
        <locationY>1535</locationY>
        <collectionReference>FilterTypeAccount</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>AssignTemplateOK</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Loop_Order_Product</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Get_Conga_Query</name>
        <label>Get Conga Query</label>
        <locationX>1282</locationX>
        <locationY>4943</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Conga_Query</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>APXTConga4__Conga_Solution__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>FilterAllTemplateList.CongaSolution__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>APXTConga4__Conga_Solution_Query__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Conga_Template</name>
        <label>Get_Conga_Template</label>
        <locationX>930</locationX>
        <locationY>4367</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Conga_Template</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>APXTConga4__Conga_Solution__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>FilterAllTemplateList.CongaSolution__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>APXTConga4__Conga_Solution_Template__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Esclusioni</name>
        <label>Get Esclusioni</label>
        <locationX>50</locationX>
        <locationY>3215</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>FilterAllTemplateList</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>CongaTemplateMapping__c</field>
            <operator>In</operator>
            <value>
                <elementReference>ListTemplateIds</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>CongaTemplateMappingException__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get sui conga mapping template filtrati per object type order</description>
        <name>GetCongaTemplateMapping</name>
        <label>GetCongaTemplateMapping</label>
        <locationX>182</locationX>
        <locationY>695</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Order_Product</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>PriceBook__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Pricebook2Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Object_Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Order</stringValue>
            </value>
        </filters>
        <filters>
            <field>Priority__c</field>
            <operator>GreaterThan</operator>
            <value>
                <elementReference>$Record.DocOrderGenerationStep__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>CongaTemplateMapping__c</object>
        <sortField>Order__c</sortField>
        <sortOrder>Asc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get di tutte le order line collegate al prodotto</description>
        <name>GetOrderLine</name>
        <label>GetOrderLine</label>
        <locationX>182</locationX>
        <locationY>575</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>GetCongaTemplateMapping</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>OrderId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>OrderItem</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get su recordtype dell&apos;account</description>
        <name>GetRecordTypeAccount</name>
        <label>GetRecordTypeAccount</label>
        <locationX>182</locationX>
        <locationY>335</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>AssignTypeAccount</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.AccountId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Account</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_Order</name>
        <label>Update Order</label>
        <locationX>50</locationX>
        <locationY>6695</locationY>
        <inputAssignments>
            <field>DocOrderGenerationStep__c</field>
            <value>
                <elementReference>NextStep</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>DynamicDocumentsGeneration__c</field>
            <value>
                <elementReference>OutboundMessageFormula</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <start>
        <locationX>56</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>GetRecordTypeAccount</targetReference>
        </connector>
        <filterLogic>(1 OR 2) AND 3</filterLogic>
        <filters>
            <field>PricebookType__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>EEim</stringValue>
            </value>
        </filters>
        <filters>
            <field>PricebookType__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>EEin</stringValue>
            </value>
        </filters>
        <filters>
            <field>Print_Document__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <object>Order</object>
        <recordTriggerType>Update</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <triggerOrder>30</triggerOrder>
    <variables>
        <name>AllTemplateMappings</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CongaTemplateMapping__c</objectType>
    </variables>
    <variables>
        <name>CongaQuery</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>CongaQueryPlainText</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>CongaQueryTemp</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>CongaTemplateKey</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>CongaTemplateKeyPlainText</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>currentItem_Filter_by_priority</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CongaTemplateMapping__c</objectType>
    </variables>
    <variables>
        <name>currentItem_Filter_by_priority_0</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CongaTemplateMapping__c</objectType>
    </variables>
    <variables>
        <name>currentItem_FilterDiscount</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CongaTemplateMapping__c</objectType>
    </variables>
    <variables>
        <name>currentItem_FilterProductTemplate</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CongaTemplateMapping__c</objectType>
    </variables>
    <variables>
        <name>currentItem_FilterSkipTempate_0</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CongaTemplateMappingException__c</objectType>
    </variables>
    <variables>
        <name>currentItem_FilterTypeAccount_0</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CongaTemplateMapping__c</objectType>
    </variables>
    <variables>
        <name>FilterMaxValue</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
        <value>
            <numberValue>99999.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>FilterMinValue</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>ListTemplateIds</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>NextStep</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>100000.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>NumTemplateToPrint</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <description>Lista per controllare i prodotti duplicati</description>
        <name>OrderLineProduct</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>SkipTemplate</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>RecordType dell&apos;account</description>
        <name>TypeAccountName</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
