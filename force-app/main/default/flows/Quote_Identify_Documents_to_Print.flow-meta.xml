<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>56.0</apiVersion>
    <assignments>
        <description>Aggiungiamo la query alla lista</description>
        <name>Add_Conga_Query</name>
        <label>Add Conga Query</label>
        <locationX>842</locationX>
        <locationY>5615</locationY>
        <assignmentItems>
            <assignToReference>CongaQuery</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>CongaQueryTemp</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Conga_Query</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Aggiungiamo il template mapping alla lista di tutti i mapping</description>
        <name>Add_Conga_Template_Mapping</name>
        <label>Add Conga Template Mapping</label>
        <locationX>1442</locationX>
        <locationY>1631</locationY>
        <assignmentItems>
            <assignToReference>AllTemplateMappings</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Template_Mapping</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Minimum_priority</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Aggiungiamo l&apos;id prodotto della quote line alla lista</description>
        <name>Add_Product_ID</name>
        <label>Add Product ID</label>
        <locationX>1222</locationX>
        <locationY>1031</locationY>
        <assignmentItems>
            <assignToReference>QuoteLineProducts</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Quote_Lines.SBQQ__Product__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>FilterTemplateForProduct</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Aggiunta della chiave template alla lista</description>
        <name>Add_Template_Key</name>
        <label>Add Template Key</label>
        <locationX>842</locationX>
        <locationY>4823</locationY>
        <assignmentItems>
            <assignToReference>CongaTemplateKey</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Conga_Template.APXTConga4__Conga_Template__r.APXTConga4__Key__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Conga_Template</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>AssignRecordTypeName</name>
        <label>AssignRecordTypeName</label>
        <locationX>606</locationX>
        <locationY>551</locationY>
        <assignmentItems>
            <assignToReference>RecordTypeName</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>GetRecordTypeAccount.RecordType.Name</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Template_Mappings</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Siccome il processo si è concluso possiamo considerare la quote firmata</description>
        <name>Copy_1_of_Quote_Signed</name>
        <label>Quote Close Signed</label>
        <locationX>842</locationX>
        <locationY>4247</locationY>
        <assignmentItems>
            <assignToReference>$Record.SBQQ__Status__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>3</stringValue>
            </value>
        </assignmentItems>
    </assignments>
    <assignments>
        <description>Controllo la casistica in cui la quote amministratore non ha quote figlie</description>
        <name>CountQuoteLine</name>
        <label>CountQuoteLine</label>
        <locationX>1040</locationX>
        <locationY>4007</locationY>
        <assignmentItems>
            <assignToReference>CountLineQuote</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>Get_Quote_Lines</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>SizeListCheck</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>ListIdTemplate</name>
        <label>ListIdTemplate</label>
        <locationX>694</locationX>
        <locationY>3191</locationY>
        <assignmentItems>
            <assignToReference>ListTemplateIds</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Template_Mapping_Id.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Template_Mapping_Id</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Siccome il processo si è concluso, ma senza documenti, possiamo portare la quote in da firmare</description>
        <name>Quote_Da_Firmare</name>
        <label>Quote Da Firmare</label>
        <locationX>1106</locationX>
        <locationY>4367</locationY>
        <assignmentItems>
            <assignToReference>$Record.SBQQ__Primary__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.SBQQ__Status__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>1</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.Print_Document__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </assignmentItems>
    </assignments>
    <assignments>
        <description>Siccome il processo si è concluso possiamo considerare la quote firmata</description>
        <name>Quote_Signed</name>
        <label>Quote Signed</label>
        <locationX>1370</locationX>
        <locationY>4367</locationY>
        <assignmentItems>
            <assignToReference>$Record.SBQQ__Ordered__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>OrderedQuote</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.SBQQ__Primary__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.SBQQ__Status__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>2</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.Print_Document__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </assignmentItems>
    </assignments>
    <assignments>
        <description>Siccome il processo si è concluso possiamo considerare la quote firmata</description>
        <name>QuoteClosed</name>
        <label>Quote Closed</label>
        <locationX>1634</locationX>
        <locationY>3887</locationY>
        <assignmentItems>
            <assignToReference>$Record.SBQQ__Status__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>3</stringValue>
            </value>
        </assignmentItems>
    </assignments>
    <assignments>
        <description>Controllo la casistica in cui la quote non ha quote figlie</description>
        <name>QuoteLineCount</name>
        <label>QuoteLineCount</label>
        <locationX>1766</locationX>
        <locationY>3647</locationY>
        <assignmentItems>
            <assignToReference>CountLineQuote</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>Get_Quote_Lines</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>CheckSizeList</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Reset a false della variabile</description>
        <name>Reset_SkipTemplate</name>
        <label>Reset SkipTemplate</label>
        <locationX>358</locationX>
        <locationY>4103</locationY>
        <assignmentItems>
            <assignToReference>SkipTemplate</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>FilterSkipTempate</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Concatenazione delle query salvate nella lista</description>
        <name>Set_Conga_Query_Plain_Text</name>
        <label>Set Conga Query Plain Text</label>
        <locationX>138</locationX>
        <locationY>6575</locationY>
        <assignmentItems>
            <assignToReference>CongaQueryPlainText</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Query_List</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CongaQueryPlainText</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>,</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Query_List</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Valorizzazione della variabile d&apos;appoggio</description>
        <name>Set_Conga_Query_temp</name>
        <label>Set Conga Query temp</label>
        <locationX>754</locationX>
        <locationY>5375</locationY>
        <assignmentItems>
            <assignToReference>CongaQueryTemp</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>[</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CongaQueryTemp</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Conga_Query.APXTConga4__Alias__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CongaQueryTemp</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>]</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CongaQueryTemp</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Conga_Query.APXTConga4__Conga_Query__r.APXTConga4__Key__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Query_already_exist</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Valorizzazione delle soglie di minimo e massimo, per filtrare solo lo step corrente, in quanto con la firma digitale si generano i documenti uno step alla volta. Senza firma digitale i documenti vengono generati tutti assieme - sono sufficienti i valori di default delle variabili affinché questo avvenga</description>
        <name>Set_Min_Max</name>
        <label>Set Min-Max</label>
        <locationX>474</locationX>
        <locationY>2615</locationY>
        <assignmentItems>
            <assignToReference>FilterMinValue</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>NextStep</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>FilterMaxValue</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>NextStep</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Filter_by_priority</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Registro la priorità minore finora rilevata</description>
        <name>Set_minimum_priority</name>
        <label>Set minimum priority</label>
        <locationX>1310</locationX>
        <locationY>1871</locationY>
        <assignmentItems>
            <assignToReference>NextStep</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Template_Mapping.Priority__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Template_Mapping</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Se non c&apos;è firma si generano tutti i documenti in una sola volta, quindi il next step viene forzato all&apos;ultimo valore possibile</description>
        <name>Set_Next_Step</name>
        <label>Set Next Step</label>
        <locationX>738</locationX>
        <locationY>2615</locationY>
        <assignmentItems>
            <assignToReference>NextStep</assignToReference>
            <operator>Assign</operator>
            <value>
                <numberValue>99999.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Filter_by_priority</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Valorizzazione della variabile di lunghezza della collection di template da stampare</description>
        <name>Set_num</name>
        <label>Set num</label>
        <locationX>606</locationX>
        <locationY>2951</locationY>
        <assignmentItems>
            <assignToReference>NumTemplateToPrint</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>Filter_by_priority</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Template_Mapping_Id</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Se mancano ancora figli da completare, togliamo semplicemente il flag per evitare che si creino altri documenti per il padre</description>
        <name>Set_Print_Document_False</name>
        <label>Set Print Document False</label>
        <locationX>578</locationX>
        <locationY>4007</locationY>
        <assignmentItems>
            <assignToReference>$Record.Print_Document__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </assignmentItems>
    </assignments>
    <assignments>
        <description>Valorizzazione del campo quote con la concatenazione delle key dei template Conga</description>
        <name>Set_Quote_field</name>
        <label>Set Quote field</label>
        <locationX>50</locationX>
        <locationY>6791</locationY>
        <assignmentItems>
            <assignToReference>$Record.DocGenerationStep__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>NextStep</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.DocumentsGenerated__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.GenerateNamirialEnvelope__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.DynamicDocumentsGenerationAndSign__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>OutboundMessageFormula</elementReference>
            </value>
        </assignmentItems>
    </assignments>
    <assignments>
        <description>Quando un&apos;offerta condominio ha finito, viene messo lo step generazione documenti a finished (valore 99999 che è il massimo accettato dal campo)</description>
        <name>Set_Quote_to_Finished</name>
        <label>Set Quote to Finished</label>
        <locationX>314</locationX>
        <locationY>3767</locationY>
        <assignmentItems>
            <assignToReference>$Record.DocGenerationStep__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <numberValue>99999.0</numberValue>
            </value>
        </assignmentItems>
    </assignments>
    <assignments>
        <description>Se il prodotto esclusione fa match con un prodotto della quote, allora questo template non deve essere inserito nella lista</description>
        <name>Set_SkipTemplate_true</name>
        <label>Set SkipTemplate true</label>
        <locationX>138</locationX>
        <locationY>3767</locationY>
        <assignmentItems>
            <assignToReference>ListEsclusioni</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Esclusioni.CongaTemplateMapping__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Esclusioni</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Valorizzazione della variabile di concatenazione delle key dei template Conga</description>
        <name>Set_Template_Key_Plain_Text</name>
        <label>Set Template Key Plain Text</label>
        <locationX>138</locationX>
        <locationY>6239</locationY>
        <assignmentItems>
            <assignToReference>CongaTemplateKeyPlainText</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Template_Key</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CongaTemplateKeyPlainText</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>,</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Template_Key</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Siccome il processo si è concluso possiamo considerare la quote firmata</description>
        <name>Signed_Quote</name>
        <label>Signed_Quote</label>
        <locationX>1898</locationX>
        <locationY>3887</locationY>
        <assignmentItems>
            <assignToReference>$Record.SBQQ__Ordered__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>OrderedQuote</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.SBQQ__Primary__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.SBQQ__Status__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>2</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>$Record.Print_Document__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </assignmentItems>
    </assignments>
    <collectionProcessors>
        <description>Teniamo dall&apos;elenco dei template solo quelli che corrispondono allo step di generazione dei documenti</description>
        <name>Filter_by_priority</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>Filter by priority</label>
        <locationX>606</locationX>
        <locationY>2831</locationY>
        <assignNextValueToReference>currentItem_Filter_by_priority_0</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>AllTemplateMappings</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_Filter_by_priority_0.Priority__c</leftValueReference>
            <operator>GreaterThanOrEqualTo</operator>
            <rightValue>
                <elementReference>FilterMinValue</elementReference>
            </rightValue>
        </conditions>
        <conditions>
            <leftValueReference>currentItem_Filter_by_priority_0.Priority__c</leftValueReference>
            <operator>LessThanOrEqualTo</operator>
            <rightValue>
                <elementReference>FilterMaxValue</elementReference>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>Set_num</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <description>Filtro per topo Account e Tipologia sconto</description>
        <name>FilterAccount</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>FilterAccount</label>
        <locationX>1222</locationX>
        <locationY>1271</locationY>
        <assignNextValueToReference>currentItem_FilterAccount</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>FilterTemplateForProduct</collectionReference>
        <conditionLogic>(1 AND 2) OR 3</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_FilterAccount.DiscountType__c</leftValueReference>
            <operator>IsNull</operator>
            <rightValue>
                <booleanValue>false</booleanValue>
            </rightValue>
        </conditions>
        <conditions>
            <leftValueReference>currentItem_FilterAccount.DiscountType__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <elementReference>$Record.DiscountType__c</elementReference>
            </rightValue>
        </conditions>
        <conditions>
            <leftValueReference>currentItem_FilterAccount.DiscountType__c</leftValueReference>
            <operator>IsNull</operator>
            <rightValue>
                <booleanValue>true</booleanValue>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>FilterRecordType</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <description>Filtro la lista Tipo Account</description>
        <name>FilterRecordType</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>FilterRecordType</label>
        <locationX>1222</locationX>
        <locationY>1391</locationY>
        <assignNextValueToReference>currentItem_FilterRecordType</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>FilterAccount</collectionReference>
        <conditionLogic>(1 AND 2) OR 3</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_FilterRecordType.AccountType__c</leftValueReference>
            <operator>IsNull</operator>
            <rightValue>
                <booleanValue>false</booleanValue>
            </rightValue>
        </conditions>
        <conditions>
            <leftValueReference>currentItem_FilterRecordType.AccountType__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <elementReference>RecordTypeName</elementReference>
            </rightValue>
        </conditions>
        <conditions>
            <leftValueReference>currentItem_FilterRecordType.AccountType__c</leftValueReference>
            <operator>IsNull</operator>
            <rightValue>
                <booleanValue>true</booleanValue>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>Loop_Template_Mapping</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <name>FilterSkipTempate</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>FilterSkipTempate</label>
        <locationX>358</locationX>
        <locationY>4223</locationY>
        <assignNextValueToReference>currentItem_FilterSkipTempate</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>Get_Esclusioni</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_FilterSkipTempate.CongaTemplateMapping__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <elementReference>Loop_2_Template_Mapping.Id</elementReference>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>Check_SkipTemplate</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <description>Filtro la lista dei template con il prodotto della singola quoteLine</description>
        <name>FilterTemplateForProduct</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>FilterTemplateForProduct</label>
        <locationX>1222</locationX>
        <locationY>1151</locationY>
        <assignNextValueToReference>currentItem_FilterTemplateForProduct</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>Get_Template_Mappings</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_FilterTemplateForProduct.Product__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <elementReference>Loop_Quote_Lines.SBQQ__Product__c</elementReference>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>FilterAccount</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <description>Ordinamento della lista di tutti i template mapping, secondo l&apos;ordinamento specificato nell&apos;oggetto</description>
        <name>Ordina_Template_Mapping</name>
        <elementSubtype>SortCollectionProcessor</elementSubtype>
        <label>Ordina Template Mapping</label>
        <locationX>606</locationX>
        <locationY>2375</locationY>
        <collectionProcessorType>SortCollectionProcessor</collectionProcessorType>
        <collectionReference>AllTemplateMappings</collectionReference>
        <connector>
            <targetReference>Firma_digitale</targetReference>
        </connector>
        <sortOptions>
            <doesPutEmptyStringAndNullFirst>false</doesPutEmptyStringAndNullFirst>
            <sortField>Order__c</sortField>
            <sortOrder>Asc</sortOrder>
        </sortOptions>
    </collectionProcessors>
    <decisions>
        <description>Se la lista ha già questo id prodotto, non viene inserito di nuovo</description>
        <name>Already_contains_element</name>
        <label>Already contains element?</label>
        <locationX>958</locationX>
        <locationY>911</locationY>
        <defaultConnector>
            <targetReference>Add_Product_ID</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>QuoteLineProducts</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>Loop_Quote_Lines.SBQQ__Product__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_Quote_Lines</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <description>Più prodotti possono condividere lo stesso template, quindi c&apos;è il rischio che venga generato più volte lo stesso documento. Questo controllo serve per evitare che accada</description>
        <name>Already_exist_element</name>
        <label>Already exist element?</label>
        <locationX>754</locationX>
        <locationY>4703</locationY>
        <defaultConnector>
            <targetReference>Add_Template_Key</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes2</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CongaTemplateKey</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>Loop_Conga_Template.APXTConga4__Conga_Template__r.APXTConga4__Key__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_Conga_Template</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <description>Se true, non viene aggiunto il template alla lista</description>
        <name>Check_SkipTemplate</name>
        <label>Check SkipTemplate</label>
        <locationX>358</locationX>
        <locationY>4343</locationY>
        <defaultConnector>
            <targetReference>Get_Conga_Template</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Add Template</defaultConnectorLabel>
        <rules>
            <name>Skip</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>ListEsclusioni</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>Loop_2_Template_Mapping.Id</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_2_Template_Mapping</targetReference>
            </connector>
            <label>Skip</label>
        </rules>
    </decisions>
    <decisions>
        <description>Controllo Se la quote ha figlie</description>
        <name>CheckSizeList</name>
        <label>CheckSizeList</label>
        <locationX>1766</locationX>
        <locationY>3767</locationY>
        <defaultConnector>
            <targetReference>Signed_Quote</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>QuoteWithoutChilds</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CountLineQuote</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>QuoteClosed</targetReference>
            </connector>
            <label>QuoteWithoutChilds</label>
        </rules>
    </decisions>
    <decisions>
        <description>Controllo se il tipo e Baslab (solo quelle baslab hanno le quote parent)</description>
        <name>DecisionBaslab</name>
        <label>DecisionBaslab</label>
        <locationX>1163</locationX>
        <locationY>3527</locationY>
        <defaultConnector>
            <targetReference>QuoteLineCount</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>TypeBaslab</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record__Prior.PricebookType__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Bsb</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Parent_Quote_Check</targetReference>
            </connector>
            <label>TypeBaslab</label>
        </rules>
    </decisions>
    <decisions>
        <description>Se la quote è con firma digitale, vengono stampati solo i documenti dello step in corso, altrimenti vengono stampati tutti assieme</description>
        <name>Firma_digitale</name>
        <label>Firma digitale?</label>
        <locationX>606</locationX>
        <locationY>2495</locationY>
        <defaultConnector>
            <targetReference>Set_Next_Step</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Stampa tutto</defaultConnectorLabel>
        <rules>
            <name>Firma_digitale_outcome</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>$Record.PrevistoInvioPDF__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.ParentQuote__r.PrevistoInvioPDF__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_Min_Max</targetReference>
            </connector>
            <label>Firma digitale</label>
        </rules>
    </decisions>
    <decisions>
        <description>Se lo step è null o 0 vuol dire che siamo al primo giro, questo significa che la quote ha lines ma nessun documento da generare, quindi si ferma allo stato da firmare, perché i documenti verranno caricati a mano. Altrimenti, significa che ha finito il suo ciclo di generazione documenti e può andare in firmata</description>
        <name>First_run</name>
        <label>First run?</label>
        <locationX>1238</locationX>
        <locationY>4247</locationY>
        <defaultConnector>
            <targetReference>Quote_Signed</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>YesRun</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>$Record.DocGenerationStep__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.DocGenerationStep__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Quote_Da_Firmare</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <description>Se la priorità del mapping è minore della variabile d&apos;appoggio, allora viene registrata</description>
        <name>Minimum_priority</name>
        <label>Minimum priority</label>
        <locationX>1442</locationX>
        <locationY>1751</locationY>
        <defaultConnector>
            <targetReference>Loop_Template_Mapping</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes3</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Loop_Template_Mapping.Priority__c</leftValueReference>
                <operator>LessThan</operator>
                <rightValue>
                    <elementReference>NextStep</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_minimum_priority</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <description>Se c&apos;è la parent quote, allora si tratta di un&apos;offerta condominio, che non deve andare in firmata</description>
        <name>Parent_Quote_Check</name>
        <label>Parent Quote Check</label>
        <locationX>561</locationX>
        <locationY>3647</locationY>
        <defaultConnector>
            <targetReference>Get_Quote_Condomini</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Parent</defaultConnectorLabel>
        <rules>
            <name>Child</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.ParentQuote__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_Quote_to_Finished</targetReference>
            </connector>
            <label>Child</label>
        </rules>
    </decisions>
    <decisions>
        <description>Aggiungiamo la query alla lista solo se non è già presente</description>
        <name>Query_already_exist</name>
        <label>Query already exist?</label>
        <locationX>754</locationX>
        <locationY>5495</locationY>
        <defaultConnector>
            <targetReference>Add_Conga_Query</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>YesQuery</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CongaQuery</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>CongaQueryTemp</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_Conga_Query</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <description>Verifica se ci sono ancora quote figlie da completare</description>
        <name>Quote_Condominio_not_completed</name>
        <label>Quote Condominio not completed?</label>
        <locationX>809</locationX>
        <locationY>3887</locationY>
        <defaultConnector>
            <targetReference>CountQuoteLine</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>YesComplete</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Quote_Condomini</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_Print_Document_False</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <description>Controllo se siamo nel caso di quote amministratore senza quote line</description>
        <name>SizeListCheck</name>
        <label>SizeListCheck</label>
        <locationX>1040</locationX>
        <locationY>4127</locationY>
        <defaultConnector>
            <targetReference>First_run</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>QuoteWithoutLine</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CountLineQuote</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Copy_1_of_Quote_Signed</targetReference>
            </connector>
            <label>QuoteWithoutLine</label>
        </rules>
    </decisions>
    <decisions>
        <description>Se non ci sono documenti da stampare è perché il processo è terminato e possiamo chiudere la quote</description>
        <name>Stop_or_Continue</name>
        <label>Stop or Continue</label>
        <locationX>606</locationX>
        <locationY>3407</locationY>
        <defaultConnector>
            <targetReference>DecisionBaslab</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Stop</defaultConnectorLabel>
        <rules>
            <name>Continue</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>NumTemplateToPrint</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Esclusioni</targetReference>
            </connector>
            <label>Continue</label>
        </rules>
    </decisions>
    <description>Updates:
- la summer &apos;22 non permette i get record con condizioni IN su collection, quindi questa versione è uguale alla precedente ma con una logica senza l&apos;utilizzo del IN. Questa versione è intesa come temporanea, da sostituire con la precedente al passaggio in winter &apos;23 di tutti gli ambienti
- l&apos;offerta viene messa in firmata solo se è parent
- aggiunta delle esclusioni
- aggiunta delle query
- ordered quote amministratre solo se ha line
- in caso di firma manuale, vengono generati tutti i documenti
- V14 Fix quote amministratore senza quoteLine
- V15 aggiunta logica filtro sui Conga template map
- V16 controllo parent child
- V19 controllo parent child + too many query
- V20 fix too many query con liste di id
- V22 Fix filter template
- V25 Fix filter Esclusioni
- v26 fix passaggio di stato senza documenti
- v27 aggiunto filtro su oggetto quote</description>
    <environments>Default</environments>
    <formulas>
        <description>La quote amministratore potrebbe non avere figli, quindi in quel caso non viene fatto l&apos;ordered</description>
        <name>OrderedQuote</name>
        <dataType>Boolean</dataType>
        <expression>{!$Record.SBQQ__LineItemCount__c}&gt;0</expression>
    </formulas>
    <formulas>
        <description>Compongo il test dell&apos;outbound message</description>
        <name>OutboundMessageFormula</name>
        <dataType>String</dataType>
        <expression>&quot;&amp;solmgr=1&quot; +
&quot;&amp;id=&quot; + {!$Record__Prior.Id} +
&quot;&amp;templateid=&quot; + LEFT({!CongaTemplateKeyPlainText}, LEN({!CongaTemplateKeyPlainText})-1) +
&quot;&amp;queryid=&quot; + LEFT({!CongaQueryPlainText}, LEN({!CongaQueryPlainText})-1) +
&quot;&amp;defaultpdf=1&quot; +
&quot;&amp;contentsharetype=V&quot; +
&quot;&amp;contentvisibility=AllUsers&quot; +
&quot;&amp;ZipFiles=0&quot; +

IF(
OR({!$Record__Prior.PricebookType__c} = &apos;Bsb&apos;, NOT({!$Record.PrevistoInvioPDF__c})),

&quot;&amp;qmode=SalesforceFile&quot;,

&quot;&amp;qmode=congasign&quot; +
&quot;&amp;csemail1=&quot; + {!$Record__Prior.CommunicationEmail__c} +
&quot;&amp;csfirst1=&quot; + {!$Record__Prior.Nome_firma_digitale__c} +
&quot;&amp;cslast1=&quot; + {!$Record__Prior.Cognome_firma_digitale__c} +
&quot;&amp;csauth1=SMS&quot; +
&quot;&amp;csmobile1=&quot; + {!$Record__Prior.MobileWithPrefix__c} +
&quot;&amp;cslang1=it&quot; +
&quot;&amp;csexpiration=&quot; + {!$Record__Prior.CSExpiration__c} +
&quot;&amp;csvisible=1&quot;
)</expression>
    </formulas>
    <interviewLabel>Quote - Identify Documents to Print {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Quote - Identify Documents to Print</label>
    <loops>
        <description>Ciclo su tutti i template mapping trovati per questa quote</description>
        <name>Loop_2_Template_Mapping</name>
        <label>Loop 2 Template Mapping</label>
        <locationX>50</locationX>
        <locationY>3983</locationY>
        <collectionReference>Filter_by_priority</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Reset_SkipTemplate</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Loop_Template_Key</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Ciclo di tutte le query trovate</description>
        <name>Loop_Conga_Query</name>
        <label>Loop Conga Query</label>
        <locationX>578</locationX>
        <locationY>5255</locationY>
        <collectionReference>Get_Conga_Query</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Set_Conga_Query_temp</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Loop_2_Template_Mapping</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Ciclo sui template trovati per ricavarne la key (univoca) da aggiungere alla quote</description>
        <name>Loop_Conga_Template</name>
        <label>Loop Conga Template</label>
        <locationX>578</locationX>
        <locationY>4583</locationY>
        <collectionReference>Get_Conga_Template</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Already_exist_element</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Get_Conga_Query</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Ciclo sulle esclusioni per ricercare se coincidono con i prodotti in offerta</description>
        <name>Loop_Esclusioni</name>
        <label>Loop Esclusioni</label>
        <locationX>50</locationX>
        <locationY>3647</locationY>
        <collectionReference>Get_Esclusioni</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Set_SkipTemplate_true</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Loop_2_Template_Mapping</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Ciclo della lista di query per salvarla come valore testuale</description>
        <name>Loop_Query_List</name>
        <label>Loop Query List</label>
        <locationX>50</locationX>
        <locationY>6455</locationY>
        <collectionReference>CongaQuery</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Set_Conga_Query_Plain_Text</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Set_Quote_field</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Ciclo sulle quote line per salvare in una lista tutti i prodotti</description>
        <name>Loop_Quote_Lines</name>
        <label>Loop Quote Lines</label>
        <locationX>606</locationX>
        <locationY>791</locationY>
        <collectionReference>Get_Quote_Lines</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Already_contains_element</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Ordina_Template_Mapping</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Ciclo sulle key dei template Conga per concatenarli in una variabile text, separandoli da virgola</description>
        <name>Loop_Template_Key</name>
        <label>Loop Template Key</label>
        <locationX>50</locationX>
        <locationY>6119</locationY>
        <collectionReference>CongaTemplateKey</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Set_Template_Key_Plain_Text</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Loop_Query_List</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Ciclo su tutti i template mapping trovati per questa quote</description>
        <name>Loop_Template_Mapping</name>
        <label>Loop Template Mapping</label>
        <locationX>1222</locationX>
        <locationY>1511</locationY>
        <collectionReference>FilterRecordType</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Add_Conga_Template_Mapping</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Loop_Quote_Lines</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>Ciclo su tutti i template mapping trovati per questa quote</description>
        <name>Loop_Template_Mapping_Id</name>
        <label>Loop_Template_Mapping_Id</label>
        <locationX>606</locationX>
        <locationY>3071</locationY>
        <collectionReference>Filter_by_priority</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>ListIdTemplate</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Stop_or_Continue</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <description>Get di tutte le query delle solution</description>
        <name>Get_Conga_Query</name>
        <label>Get Conga Query</label>
        <locationX>578</locationX>
        <locationY>5135</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Conga_Query</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>APXTConga4__Conga_Solution__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Loop_2_Template_Mapping.CongaSolution__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>APXTConga4__Conga_Solution_Query__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Recupero di tutti i template associati alle Conga Solution</description>
        <name>Get_Conga_Template</name>
        <label>Get Conga Template</label>
        <locationX>578</locationX>
        <locationY>4463</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Conga_Template</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>APXTConga4__Conga_Solution__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Loop_2_Template_Mapping.CongaSolution__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>APXTConga4__Conga_Solution_Template__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Recupero delle esclusioni eventualmente associate a questo mapping, per verificare se è possibile aggiungerlo o deve essere scartato</description>
        <name>Get_Esclusioni</name>
        <label>Get Esclusioni</label>
        <locationX>50</locationX>
        <locationY>3527</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Esclusioni</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>CongaTemplateMapping__c</field>
            <operator>In</operator>
            <value>
                <elementReference>ListTemplateIds</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>CongaTemplateMappingException__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Recupero delle quote condomini, per vedere se ce ne sono alcune per cui devono ancora generarsi documenti</description>
        <name>Get_Quote_Condomini</name>
        <label>Get Quote Condomini</label>
        <locationX>809</locationX>
        <locationY>3767</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Quote_Condominio_not_completed</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ParentQuote__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>DocGenerationStep__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <numberValue>99999.0</numberValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>SBQQ__Quote__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get di tutte le quote line della quote</description>
        <name>Get_Quote_Lines</name>
        <label>Get Quote Lines</label>
        <locationX>606</locationX>
        <locationY>311</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>GetRecordTypeAccount</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>SBQQ__Quote__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>SBQQ__QuoteLine__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get di tutti i template mapping che rispettano le condizioni: prodotto, listino</description>
        <name>Get_Template_Mappings</name>
        <label>Get Template Mappings</label>
        <locationX>606</locationX>
        <locationY>671</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Quote_Lines</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>PriceBook__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.SBQQ__PriceBook__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Priority__c</field>
            <operator>GreaterThan</operator>
            <value>
                <elementReference>$Record.DocGenerationStep__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Object_Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>SBQQ__Quote__c</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>CongaTemplateMapping__c</object>
        <sortField>Order__c</sortField>
        <sortOrder>Asc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Recupero il recordType della quote in contesto</description>
        <name>GetRecordTypeAccount</name>
        <label>GetRecordTypeAccount</label>
        <locationX>606</locationX>
        <locationY>431</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>AssignRecordTypeName</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.SBQQ__Account__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Account</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <start>
        <locationX>480</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_Quote_Lines</targetReference>
        </connector>
        <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
        <filterLogic>1 AND (2 OR 3 OR 4) AND 5</filterLogic>
        <filters>
            <field>SBQQ__Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>1</stringValue>
            </value>
        </filters>
        <filters>
            <field>PricebookType__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Bsb</stringValue>
            </value>
        </filters>
        <filters>
            <field>PricebookType__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>EEim</stringValue>
            </value>
        </filters>
        <filters>
            <field>PricebookType__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>EEin</stringValue>
            </value>
        </filters>
        <filters>
            <field>Print_Document__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <object>SBQQ__Quote__c</object>
        <recordTriggerType>Update</recordTriggerType>
        <triggerType>RecordBeforeSave</triggerType>
    </start>
    <status>Active</status>
    <variables>
        <description>Variabile dove vengono aggiunti tutti i template mapping trovati per ogni quote line</description>
        <name>AllTemplateMappings</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CongaTemplateMapping__c</objectType>
    </variables>
    <variables>
        <description>Lista di tutte le query da utilizzare per questa quote</description>
        <name>CongaQuery</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Elenco delle query in forma di testo, da salvare sulla quote</description>
        <name>CongaQueryPlainText</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Variabile d&apos;appoggio per il salvataggio delle conga queries</description>
        <name>CongaQueryTemp</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Lista delle key dei template Conga che dovranno essere generati sulla quote</description>
        <name>CongaTemplateKey</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Variabile che conterrà la concatenazione di tutte le Key dei template Conga, separate da virgola</description>
        <name>CongaTemplateKeyPlainText</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>ConvertRecordType</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Variable count per effettuare il controllo della lista</description>
        <name>CountLineQuote</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>currentItem_Filter_by_priority_0</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CongaTemplateMapping__c</objectType>
    </variables>
    <variables>
        <name>currentItem_FilterAccount</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CongaTemplateMapping__c</objectType>
    </variables>
    <variables>
        <name>currentItem_FilterRecordType</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CongaTemplateMapping__c</objectType>
    </variables>
    <variables>
        <name>currentItem_FilterSkipTempate</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CongaTemplateMappingException__c</objectType>
    </variables>
    <variables>
        <name>currentItem_FilterTemplateForProduct</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CongaTemplateMapping__c</objectType>
    </variables>
    <variables>
        <description>Soglia massima da utilizzare nel filtro</description>
        <name>FilterMaxValue</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
        <value>
            <numberValue>99999.0</numberValue>
        </value>
    </variables>
    <variables>
        <description>Limite minore da utilizzare nel filtro</description>
        <name>FilterMinValue</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>ListEsclusioni</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>ListTemplateIds</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Definisce il prossimo valore di priority da utilizzare per determinare quali documenti stampare</description>
        <name>NextStep</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>100000.0</numberValue>
        </value>
    </variables>
    <variables>
        <description>Numero di template da generare dopo che è stato applicato il filtro dello step</description>
        <name>NumTemplateToPrint</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <description>List di tutti i prodotti delle quote line</description>
        <name>QuoteLineProducts</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>RecordTypeName</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Variabili di controllo utilizzata per verificare se il template debba essere escluso, nel caso siano presenti esclusioni al mapping</description>
        <name>SkipTemplate</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
</Flow>
